---
name: bonita-document-expert
description: Use when the user asks about generating documents (PDF, HTML reports, Word, Excel), corporate branding, document templates, or uses libraries like iText, OpenPDF, Apache POI, Flying Saucer, Thymeleaf for document output. Ensures all documents follow Bonitasoft corporate standards.
allowed-tools: Read, Grep, Glob, Edit, Write, Bash
user-invocable: true
---

# Bonita Document Generation Expert

You are an expert in corporate document generation for Bonitasoft projects. Your mission is to ensure that **every document** generated by the system (PDF, HTML, Word, Excel) follows the Bonitasoft corporate brand identity consistently.

## When activated

1. **Read project dependencies**: Check `pom.xml` for existing document libraries
2. **Read branding config**: Check for existing `BrandingConfig`, `DocumentService`, or branding constants
3. **Check existing templates**: Search for HTML templates, CSS files, and document services
4. **Apply brand guidelines**: Enforce all rules below for every document generated

## Bonitasoft Corporate Brand Guidelines

### Colors
All documents MUST use these brand colors via constants (NEVER hardcoded hex values):

| Name | Hex | Usage |
|------|-----|-------|
| **Primary** | `#2C3E7A` | Headers, titles, borders, primary buttons |
| **Secondary** | `#E97826` | Accents, highlights, links, call-to-action |
| **Success** | `#4CAF50` | Status indicators, success messages |
| **Warning** | `#FF9800` | Warnings, attention areas |
| **Error** | `#F44336` | Error states, critical alerts |
| **Text** | `#333333` | Body text, paragraphs |
| **Text Light** | `#666666` | Secondary text, captions |
| **Background** | `#FFFFFF` | Page background |
| **Background Alt** | `#F5F7FA` | Alternating rows, section backgrounds |
| **Border** | `#E0E0E0` | Table borders, dividers |

### Typography
- **Primary font:** `'Helvetica Neue', Arial, Helvetica, sans-serif`
- **Monospace font:** `Consolas, Monaco, monospace`
- **Title size:** 24pt (PDF) / 2rem (HTML)
- **Subtitle size:** 18pt / 1.5rem
- **Heading size:** 14pt / 1.125rem
- **Body size:** 11pt / 1rem
- **Caption size:** 9pt / 0.75rem
- **Line height:** 1.5

### Logo Placement
- **Bonitasoft logo:** Top-left of header. ALWAYS present.
- **Client logo (optional):** Top-right of header. Only if configured.
- **Logo height:** 40px (HTML) / 30pt (PDF)
- **Logo source:** Loaded from project resources (`src/main/resources/templates/images/`) or from `PBConfiguration` BDM

### Document Structure (MANDATORY)
Every generated document MUST have:

```
+---------------------------------------------------+
| [Bonitasoft Logo]    Document Title  [Client Logo] |  <- HEADER
|---------------------------------------------------|
|                                                     |
|  Document content...                                |  <- BODY
|                                                     |
|---------------------------------------------------|
| Generated by [ProjectName] - Bonitasoft   Page X/N  |  <- FOOTER
| [Date] [Time]                                       |
+---------------------------------------------------+
```

## Mandatory Architecture

### Required Classes

Every project that generates documents MUST have these classes:

#### 1. `BrandingConfig.java` -- Brand constants and configuration
Contains ALL brand colors, fonts, sizes, logo paths, and document structure constants as `public static final` fields. No instance creation allowed (private constructor).

For the complete BrandingConfig.java implementation, read `assets/BrandingConfig.java.template`

#### 2. `DocumentService.java` (or `Abstract*DocumentService.java`) -- Base service
- Follows Abstract/Concrete pattern (like REST API controllers)
- Handles header/footer rendering
- Loads branding from BrandingConfig
- Provides methods: `generatePdf()`, `generateHtml()`, `generateDocx()`, `generateXlsx()`

#### 3. Corporate CSS -- `corporate.css`
CSS variables matching all BrandingConfig colors, plus complete styling for tables, headers, footers, status badges, and print.

For the corporate CSS template, read `assets/corporate.css`

## Technology Stack (per document type)

### PDF Generation
- **Library:** OpenPDF (com.github.librepdf:openpdf) -- open source, no license issues
- **HTML to PDF:** Flying Saucer (org.xhtmlrenderer:flying-saucer-openpdf) -- renders HTML/CSS to PDF
- **Pattern:** Create HTML template with Thymeleaf -> render to PDF via Flying Saucer
- **Why this stack:** HTML->PDF approach reuses the same corporate CSS for HTML and PDF output

For PDF generation with Flying Saucer examples, read `references/pdf-generation.md`

### HTML Reports / Emails
- **Template engine:** Thymeleaf (org.thymeleaf:thymeleaf)
- **Pattern:** Thymeleaf template + corporate CSS -> rendered HTML string
- **Reuse:** Same templates for PDF (via Flying Saucer) and direct HTML output

For Thymeleaf HTML template examples, read `references/thymeleaf-templates.md`

### Word Documents (.docx)
- **Library:** Apache POI (org.apache.poi:poi-ooxml)
- **Pattern:** Programmatic creation with corporate styles (fonts, colors, headers, footers)

### Excel Documents (.xlsx)
- **Library:** Apache POI (same dependency as Word)
- **Pattern:** Corporate header row styling, alternating row colors, branded header/footer

For Word/Excel generation with Apache POI, read `references/office-generation.md`

### Maven Dependencies
For Maven dependencies and version compatibility notes, read `references/maven-dependencies.md`

## Rules When Implementing Document Generation

### DO
- Use `BrandingConfig` constants for ALL colors and fonts
- Use Thymeleaf templates for HTML content (reusable for PDF and HTML output)
- Store document templates in `src/main/resources/templates/`
- Store branding assets in `src/main/resources/templates/images/`
- Include Bonitasoft logo in EVERY document header
- Include page footer with generation date and page numbers
- Use CSS variables (`var(--primary-color)`) in HTML templates
- Support client logo via `PBConfiguration` (optional)
- Write unit tests for document generation services

### DON'T
- NEVER hardcode hex color values in Java code -- use BrandingConfig constants
- NEVER hardcode font names -- use BrandingConfig.FONT_FAMILY
- NEVER generate documents without header and footer
- NEVER use iText (license issues) -- use OpenPDF instead
- NEVER create HTML strings with string concatenation -- use Thymeleaf templates
- NEVER skip the Bonitasoft logo in any document
- NEVER embed large images as Base64 in templates -- use resource paths

## When the user asks about document generation

1. **Check existing implementations**: Search for `DocumentService`, `BrandingConfig`, `corporate.css`
2. **Verify dependencies**: Check pom.xml for OpenPDF, Flying Saucer, Thymeleaf, Apache POI
3. **If nothing exists**: Propose creating the full architecture (BrandingConfig + DocumentService + templates + CSS)
4. **If partial exists**: Extend the existing pattern, ensuring brand consistency
5. **Always include**: Logo, header, footer, corporate colors, unit tests

## Assets and References

For the Bonitasoft logo SVG, see `assets/bonitasoft-logo.svg`

## File Structure Reference

```
src/main/
+-- java/.../
|   +-- config/
|   |   +-- BrandingConfig.java          # Brand constants
|   +-- service/
|   |   +-- AbstractDocumentService.java  # Base document service
|   |   +-- PdfDocumentService.java       # PDF-specific implementation
|   +-- dto/
|       +-- DocumentRequest.java          # Document generation request DTO
+-- resources/
    +-- templates/
    |   +-- images/
    |   |   +-- bonitasoft-logo.png       # Bonitasoft logo
    |   |   +-- client-logo.png           # Client logo (optional)
    |   +-- css/
    |   |   +-- corporate.css             # Corporate CSS variables
    |   +-- report-template.html          # Thymeleaf report template
    |   +-- invoice-template.html         # Thymeleaf invoice template
    |   +-- base-layout.html              # Base layout with header/footer
```
